parameters:
  kapitan:
    dependencies:
      - type: https
        source: https://github.com/appuio/control-api/releases/download/${control_api:images:control-api:tag}/crd.yaml
        output_path: dependencies/control-api/crds/${control_api:images:control-api:tag}/01_crds.yaml

      - type: https
        source: https://raw.githubusercontent.com/appuio/control-api/${control_api:images:control-api:tag}/config/rbac/role.yaml
        output_path: dependencies/control-api/manifests/${control_api:images:control-api:tag}/apiserver/role.yaml
      - type: https
        source: https://raw.githubusercontent.com/appuio/control-api/${control_api:images:control-api:tag}/config/rbac/role_binding.yaml
        output_path: dependencies/control-api/manifests/${control_api:images:control-api:tag}/apiserver/role_binding.yaml
      - type: https
        source: https://raw.githubusercontent.com/appuio/control-api/${control_api:images:control-api:tag}/config/rbac/role_binding_auth_delegator.yaml
        output_path: dependencies/control-api/manifests/${control_api:images:control-api:tag}/apiserver/role_binding_auth_delegator.yaml
      - type: https
        source: https://raw.githubusercontent.com/appuio/control-api/${control_api:images:control-api:tag}/config/rbac/service_account.yaml
        output_path: dependencies/control-api/manifests/${control_api:images:control-api:tag}/apiserver/service_account.yaml
      - type: https
        source: https://raw.githubusercontent.com/appuio/control-api/${control_api:images:control-api:tag}/config/deployment/deployment.yaml
        output_path: dependencies/control-api/manifests/${control_api:images:control-api:tag}/apiserver/deployment.yaml
      - type: https
        source: https://raw.githubusercontent.com/appuio/control-api/${control_api:images:control-api:tag}/config/deployment/service.yaml
        output_path: dependencies/control-api/manifests/${control_api:images:control-api:tag}/apiserver/service.yaml
      - type: https
        source: https://raw.githubusercontent.com/appuio/control-api/${control_api:images:control-api:tag}/config/deployment/apiservice.yaml
        output_path: dependencies/control-api/manifests/${control_api:images:control-api:tag}/apiserver/apiservice.yaml

      - type: https
        source: https://raw.githubusercontent.com/appuio/control-api/${control_api:images:control-api:tag}/config/user-rbac/basic-user-role.yml
        output_path: dependencies/control-api/manifests/${control_api:images:control-api:tag}/rbac/basic-user-role.yaml
      - type: https
        source: https://raw.githubusercontent.com/appuio/control-api/${control_api:images:control-api:tag}/config/user-rbac/basic-user-rolebinding.yml
        output_path: dependencies/control-api/manifests/${control_api:images:control-api:tag}/rbac/basic-user-rolebinding.yaml
      - type: https
        source: https://raw.githubusercontent.com/appuio/control-api/${control_api:images:control-api:tag}/config/user-rbac/organization-admin-role.yml
        output_path: dependencies/control-api/manifests/${control_api:images:control-api:tag}/rbac/organization-admin-role.yaml
      - type: https
        source: https://raw.githubusercontent.com/appuio/control-api/${control_api:images:control-api:tag}/config/user-rbac/organization-viewer-role.yml
        output_path: dependencies/control-api/manifests/${control_api:images:control-api:tag}/rbac/organization-viewer-role.yaml
    compile:
      - input_paths:
          - control-api/component/app.jsonnet
        input_type: jsonnet
        output_path: apps/
      - input_paths:
          - control-api/component/main.jsonnet
        input_type: jsonnet
        output_path: control-api/
      - input_paths:
          - control-api/component/api-server.jsonnet
        input_type: jsonnet
        output_path: control-api/01_api_server/

      - input_paths:
          - control-api/crds/${control_api:images:control-api:tag}/
        output_path: control-api/
        input_type: copy
        output_type: yaml
